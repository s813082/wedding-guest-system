<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Stitch Design</title>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Newsreader%3Awght%40400%3B500%3B700%3B800&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<script src="../config/config.js"></script>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<style type="text/tailwindcss">
        :root {
            --primary-color: #1791cf;
            --secondary-color: #f0f3f4;
            --text-color: #111518;
            --background-color: #f3e9d8;
            --accent-color: #e0f7fa;
            --subtle-border: #e0e0e0;
        }
        body {
            font-family: 'Newsreader', 'Noto Sans', sans-serif;
        }
        .form-input {
            background-color: white;
            border: 1px solid var(--subtle-border);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            transition: all 0.2s ease-in-out;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(23, 145, 207, 0.1);
        }
        .form-input:disabled {
            background-color: #f3f4f6;
            cursor: not-allowed;
        }
        .checkbox-custom {
            appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid var(--subtle-border);
            border-radius: 0.375rem;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease-in-out;
        }
        .checkbox-custom:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        .checkbox-custom:checked::after {
            content: "✔";
            color: white;
            font-size: 0.8rem;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .btn-primary:hover {
            background-color: #147ab3;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .magic-wand-icon {
            font-family: 'Material Symbols Outlined';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }
    </style>
</head>
<body class="bg-[var(--background-color)]">
<div class="relative flex size-full min-h-screen flex-col group/design-root overflow-x-hidden">
<div class="layout-container flex h-full grow flex-col">
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-[var(--subtle-border)] bg-white px-10 py-4 shadow-sm">
<div class="flex items-center gap-3 text-[var(--text-color)]">
<span class="material-symbols-outlined text-3xl text-[var(--primary-color)]">auto_stories</span>
<h1 class="text-xl font-bold leading-tight tracking-[-0.015em]">Enchanted Check-In</h1>
</div>
<div class="flex flex-1 justify-end gap-6">
<nav class="flex items-center gap-8">
<a class="text-sm font-medium text-[var(--text-color)] hover:text-[var(--primary-color)] transition-colors" href="#">Dashboard</a>
<a class="text-sm font-medium text-[var(--text-color)] hover:text-[var(--primary-color)] transition-colors" href="#">Guests</a>
<a class="text-sm font-medium text-[var(--text-color)] hover:text-[var(--primary-color)] transition-colors" href="#">Tables</a>
<a class="text-sm font-medium text-[var(--text-color)] hover:text-[var(--primary-color)] transition-colors" href="#">Gifts</a>
</nav>
<div class="flex items-center gap-4">
<button class="flex size-10 cursor-pointer items-center justify-center rounded-full bg-[var(--secondary-color)] text-[var(--text-color)] transition-colors hover:bg-gray-200">
<span class="material-symbols-outlined">notifications</span>
</button>
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 border-2 border-white shadow-md" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAzoLzGX5LzjT3jrnVLh1olWlJv05hkIF-_4qpqB7r3vt_6DxQoFKqlER0FwQC8_ovDJtJbJNrZKOnh1hSVs9rwgpEToPlx8yQDXhBy17Fc1d-_dRUvIy-CidFexPgY3FqRWoR3TCzU1oV7tMiWTH625DSiyPEc8dJhUu3q22m088UVWfE_haSPGhm5-fsXAEZ-bX5n2WAEFT8WFsOtMsZFRTQiR7v199fv3ph7Is0BX9mm05BO0wDLmkKqMKlWATVFEsluPKaILAk");'></div>
</div>
</div>
</header>
<main class="flex flex-1 justify-center py-12">
<div class="w-full max-w-2xl px-4">
<div class="bg-white p-8 sm:p-12 rounded-2xl shadow-lg border border-[var(--subtle-border)]">
<div class="text-center mb-10 relative">
<button onclick="goBack()" class="absolute left-0 top-0 flex items-center gap-2 text-sm font-medium text-[var(--primary-color)] hover:text-blue-700 transition-colors">
<span class="material-symbols-outlined text-lg">arrow_back</span>
回到賓客清單
</button>
<h2 class="text-3xl font-bold text-[var(--text-color)] tracking-tight">Guest Check-In</h2>
<p class="mt-2 text-base text-gray-500">Welcome to a magical celebration!</p>
</div>
<form class="space-y-6">
<div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium leading-6 text-[var(--text-color)]" for="serial-number">System Serial Number</label>
<div class="mt-2">
<input class="form-input w-full" id="serial-number" name="serial-number" placeholder="e.g., 934" type="text"/>
</div>
</div>
<div>
<label class="block text-sm font-medium leading-6 text-[var(--text-color)]" for="guest-name">Guest Name</label>
<div class="mt-2">
<input class="form-input w-full" id="guest-name" name="guest-name" placeholder="e.g., Luna Lovegood" type="text"/>
</div>
</div>
</div>
<div class="space-y-4 pt-4 border-t border-gray-200">
<div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
<div class="relative flex items-start">
<div class="flex h-6 items-center">
<input class="checkbox-custom" id="collect-money" name="collect-money" type="checkbox"/>
</div>
<div class="ml-3 text-sm leading-6">
<label class="font-medium text-[var(--text-color)] cursor-pointer" for="collect-money">Collect Gift Money</label>
</div>
</div>
<div class="relative flex items-start">
<div class="flex h-6 items-center">
<input class="checkbox-custom" id="has-cake" name="has-cake" type="checkbox"/>
</div>
<div class="ml-3 text-sm leading-6">
<label class="font-medium text-[var(--text-color)] cursor-pointer" for="has-cake">Has Wedding Cake</label>
</div>
</div>
</div>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-6 items-end">
<div id="gift-amount-section">
<label class="block text-sm font-medium leading-6 text-[var(--text-color)]" for="gift-amount">Amount of Gift Money Collected</label>
<div class="relative mt-2 rounded-md shadow-sm">
<div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
<span class="text-gray-500 sm:text-sm"></span>
</div>
<input class="form-input block w-full pl-20" disabled="" id="gift-amount" name="gift-amount" placeholder="0.00" type="number"/>
</div>
</div>
<div class="relative flex items-start" id="cake-given-section">
<div class="flex h-6 items-center">
<input class="checkbox-custom" id="cake-given" name="cake-given" type="checkbox"/>
</div>
<div class="ml-3 text-sm leading-6">
<label class="font-medium text-[var(--text-color)] cursor-pointer" for="cake-given">Wedding Cake Given</label>
</div>
</div>
</div>
<div class="pt-6 text-center">
<button class="btn-primary inline-flex items-center gap-2" type="submit">
<span class="magic-wand-icon text-lg">auto_fix_high</span> Check-in Successful
                            </button>
</div>
</form>
</div>
</div>
</main>
</div>
</div>
<script>
    // Google Apps Script URL 從配置文件載入
    const GOOGLE_SCRIPT_URL = window.CONFIG?.GOOGLE_SCRIPT_URL || alert('請先設定 config.js 配置文件！');
    
    // 回到賓客清單頁面
    function goBack() {
        // 添加時間戳確保頁面重新載入並刷新資料
        window.location.href = 'guestlist.html?refresh=' + Date.now();
    }

    document.addEventListener('DOMContentLoaded', function() {
        // 處理 URL 參數，預填賓客資訊
        const urlParams = new URLSearchParams(window.location.search);
        const serialNumber = urlParams.get('sn');
        const guestName = urlParams.get('name');
        const collectMoney = urlParams.get('collectMoney') === 'true';
        const hasCake = urlParams.get('hasCake') === 'true';

        if (serialNumber) {
            document.getElementById('serial-number').value = serialNumber;
        }
        if (guestName) {
            document.getElementById('guest-name').value = decodeURIComponent(guestName);
        }
        if (collectMoney) {
            document.getElementById('collect-money').checked = true;
        }
        if (hasCake) {
            document.getElementById('has-cake').checked = true;
        }

        const collectMoneyCheckbox = document.getElementById('collect-money');
        const giftAmountInput = document.getElementById('gift-amount');
        const giftAmountSection = document.getElementById('gift-amount-section');
        const form = document.querySelector('form');

        function toggleGiftAmount() {
            if (collectMoneyCheckbox.checked) {
                giftAmountInput.disabled = false;
                giftAmountSection.classList.remove('opacity-50');
            } else {
                giftAmountInput.disabled = true;
                giftAmountInput.value = '';
                giftAmountSection.classList.add('opacity-50');
            }
        }

        collectMoneyCheckbox.addEventListener('change', toggleGiftAmount);

        // 表單提交處理
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const button = form.querySelector('button[type="submit"]');
            const originalText = button.innerHTML;
            button.innerHTML = '<span class="magic-wand-icon text-lg">hourglass_top</span> 提交中...';
            button.disabled = true;

            try {
                const formData = new FormData(form);
                const data = {
                    serialNumber: formData.get('serial-number'),
                    guestName: formData.get('guest-name'),
                    collectMoney: formData.get('collect-money') === 'on',
                    giftAmount: parseInt(formData.get('gift-amount')) || 0,
                    hasCake: formData.get('has-cake') === 'on',
                    cakeGiven: formData.get('cake-given') === 'on'
                };
                
                // 調試：顯示要傳送的資料
                console.log('準備傳送的資料:', data);
                console.log('表單原始資料:', {
                    'serial-number': formData.get('serial-number'),
                    'guest-name': formData.get('guest-name'),
                    'collect-money': formData.get('collect-money'),
                    'gift-amount': formData.get('gift-amount'),
                    'has-cake': formData.get('has-cake'),
                    'cake-given': formData.get('cake-given')
                });

                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                // no-cors 模式無法讀取回應，假設提交成功
                console.log('資料已提交 (no-cors 模式)');
                
                // 成功提示
                button.innerHTML = '<span class="magic-wand-icon text-lg">check_circle</span> 簽到成功！';
                button.style.backgroundColor = '#22c55e';

                // 2秒後自動跳轉回賓客清單
                setTimeout(() => {
                    window.location.href = 'guestlist.html?refresh=' + Date.now();
                }, 2000);

            } catch (error) {
                console.error('Error:', error);
                button.innerHTML = '<span class="magic-wand-icon text-lg">error</span> 提交失敗，請重試';
                button.style.backgroundColor = '#ef4444';

                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.backgroundColor = 'var(--primary-color)';
                    button.disabled = false;
                }, 3000);
            }
        });

        // Initial state
        toggleGiftAmount();
    });
</script>

</body></html>